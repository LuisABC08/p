{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Detalle del Pedido #{{ pedido.id }}</h1>
        <a href="{% url 'lista_pedidos' %}" class="btn btn-outline">Volver a Pedidos</a>
    </div>

    <div class="pedido-detalle">
        <div class="detalle-info">
            <div class="info-card">
                <h3>Información del Pedido</h3>
                <p><strong>Cliente:</strong> {{ pedido.cliente.user.username }}</p>
                <p><strong>Email:</strong> {{ pedido.cliente.correo|default:pedido.cliente.user.email }}</p>
                <p><strong>Teléfono:</strong> {{ pedido.cliente.telefono|default:"No proporcionado" }}</p>
                <p><strong>Fecha:</strong> {{ pedido.fecha_pedido|date:"d/m/Y H:i" }}</p>
                <p><strong>Dirección de envío:</strong> {{ pedido.direccion_envio }}</p>
                <p><strong>Total:</strong> ${{ pedido.total|floatformat:2 }}</p>
                
                <div class="estado-section">
                    <h4>Estado Actual: 
                        <span class="estado-badge estado-{{ pedido.estado }}">
                            {{ pedido.get_estado_display }}
                        </span>
                    </h4>
                    
                    <form method="post" action="{% url 'cambiar_estado_pedido' pedido.id %}" class="estado-form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="estado">Cambiar Estado:</label>
                            <select name="estado" id="estado" class="form-control">
                                {% for valor, etiqueta in pedido.ESTADOS %}
                                <option value="{{ valor }}" {% if pedido.estado == valor %}selected{% endif %}>
                                    {{ etiqueta }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Actualizar Estado</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="detalle-items">
            <div class="items-card">
                <h3>Items del Pedido</h3>
                <div class="items-list">
                    {% for item in items %}
                    <div class="item-detalle">
                        <div class="item-info">
                            <h4>{{ item.producto.nombre }}</h4>
                            <p class="item-detail">Cantidad: {{ item.cantidad }}</p>
                            <p class="item-detail">Precio unitario: ${{ item.precio_unitario }}</p>
                            <p class="item-detail">Subtotal: ${{ item.subtotal }}</p>
                        </div>
                    </div>
                    {% empty %}
                    <p>No hay items en este pedido.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}